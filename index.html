import React, { useEffect, useState } from 'react';

// Use a dynamic import for Amplify to prevent the module resolution error
// from occurring during the initial build phase.
const importAmplify = async () => {
  try {
    const { Amplify } = await import('aws-amplify');
    const { Authenticator, View, Card, Button, Heading, Text, Flex } = await import('@aws-amplify/ui-react');
    await import('@aws-amplify/ui-react/styles.css');
    // Import the AWS configuration file which would be auto-generated by the Amplify CLI.
    const awsExports = await import('./aws-exports');
    return { Amplify, Authenticator, View, Card, Button, Heading, Text, Flex, awsExports };
  } catch (error) {
    console.error("Failed to load Amplify modules or aws-exports.js:", error);
    return {};
  }
};

// The main application component.
function App() {
  const [amplifyModules, setAmplifyModules] = useState(null);

  useEffect(() => {
    const loadModules = async () => {
      const modules = await importAmplify();
      if (modules.Amplify && modules.awsExports) {
        // In a real, live environment, the aws-exports.js file is automatically
        // generated and contains your AWS configuration.
        modules.Amplify.configure(modules.awsExports.default);
        setAmplifyModules(modules);
      }
    };
    loadModules();
  }, []);

  if (!amplifyModules) {
    return (
      <div className="flex items-center justify-center min-h-screen bg-gray-900 bg-gradient-to-br from-gray-900 via-slate-950 to-gray-900 text-white">
        <p>Loading...</p>
      </div>
    );
  }

  const { Authenticator, View, Card, Button, Heading, Text, Flex } = amplifyModules;

  return (
    // The Authenticator component handles the entire authentication flow.
    <Authenticator>
      {({ signOut, user }) => (
        // Main application container with a dark blue gradient background.
        <View className="min-h-screen bg-gray-900 bg-gradient-to-br from-gray-900 via-slate-950 to-gray-900 text-gray-100 font-sans flex items-center justify-center p-4">
          <Flex direction="column" className="max-w-4xl w-full">
            {/* Header section with a logout button */}
            <Flex justifyContent="between" alignItems="center" className="w-full mb-8 p-4 bg-slate-800/50 backdrop-blur-sm rounded-lg shadow-lg border border-slate-700">
              <Heading level={2} className="text-xl sm:text-2xl font-bold tracking-tight text-gray-100">
                Report Classifier Dashboard
              </Heading>
              <Button
                onClick={signOut}
                className="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition-colors duration-200"
              >
                Sign Out
              </Button>
            </Flex>

            {/* Main content section */}
            <Flex direction="column" className="w-full gap-8">
              {/* Welcome message */}
              <Card className="p-6 bg-slate-800/50 backdrop-blur-sm rounded-xl shadow-xl border border-slate-700">
                <Heading level={3} className="text-xl sm:text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-gray-50 mb-2">
                  Welcome, {user.username}!
                </Heading>
                <Text className="text-gray-300">
                  You are now logged in. This is your personal AI dashboard.
                  Here, you can upload reports and logs for classification against the MITRE ATT&CK framework.
                </Text>
              </Card>

              {/* Feature card: AI Report Classifier */}
              <Card className="p-6 bg-slate-800/50 backdrop-blur-sm rounded-xl shadow-xl border border-slate-700">
                <Flex direction="column" className="gap-4">
                  <Heading level={4} className="text-xl font-bold text-gray-100">
                    <Flex alignItems="center" className="gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth={2} stroke="currentColor" className="w-6 h-6 text-blue-400">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M3.75 13.5l10.5-10.5a1.5 1.5 0 012.1 2.1l-10.5 10.5m-7.5 7.5h16.5m-9-6.75h6" />
                      </svg>
                      AI Report Classifier
                    </Flex>
                  </Heading>
                  <Text className="text-gray-400">
                    Upload your security reports or system logs to get an automated
                    classification based on the MITRE ATT&CK framework. Our AI model will provide
                    a confidence score for each identified technique.
                  </Text>
                  <Button
                    variation="primary"
                    className="mt-4 w-full sm:w-auto px-6 py-3 font-semibold rounded-lg shadow-lg
                             bg-gradient-to-r from-blue-600 to-blue-800
                             hover:from-blue-700 hover:to-blue-900
                             transition-all duration-300 transform hover:scale-105"
                  >
                    Analyze New Report
                  </Button>
                </Flex>
              </Card>
            </Flex>
          </Flex>
        </View>
      )}
    </Authenticator>
  );
}

export default App;
